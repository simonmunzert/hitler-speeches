election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched cases for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines
dat <- arrange(dat, lfnr, election)
# lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
#       dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
#       type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2)) # exposed units
# lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1)) # control units
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
pdf(file="../figures/pretreatment_trends.pdf", height=10, width=7, family="URWTimes")
par(oma=c(0,0,0,0))
par(mar=c(3,4,5,3))
par(mfrow=c(3,1))
par(xaxs = "i", yaxs = "i")
election_names <-  c("May 1928", "Sep 1930", "Jul 1932", "Nov 1932", "Mar 1933")
for (i in 2:4) {
# select relevant elections
dat <- match.data.long.list[[i]]
dat <- filter(dat, election <= i+1, election >= i-1)
election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched cases for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines
dat <- arrange(dat, lfnr, election)
# lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
#       dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
#       type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2)) # exposed units
lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1)) # control units
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
pdf(file="../figures/pretreatment_trends.pdf", height=10, width=7, family="URWTimes")
par(oma=c(0,0,0,0))
par(mar=c(3,4,5,3))
par(mfrow=c(3,1))
par(xaxs = "i", yaxs = "i")
election_names <-  c("May 1928", "Sep 1930", "Jul 1932", "Nov 1932", "Mar 1933")
for (i in 2:4) {
# select relevant elections
dat <- match.data.long.list[[i]]
dat <- filter(dat, election <= i+1, election >= i-1)
election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched cases for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines, exposed units
dat <- arrange(dat, lfnr, election)
lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2))
# county lines, control units
# lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
#      dat$p_nsdap[((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
#      type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1))
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
## plot: pre-treatment trends -----------
# import prepared data
load("elections_all_df_pointdata_long.RData")
elections_df_long <- filter(elections_df_long, election >= 1 &  election <= 5)
# select variables
elections_df_long <- dplyr::select(elections_df_long, election, lfnr, agglvl, name,  pop, wb, gs, p_nsdap, p_kpd, p_hitl, p_turnout, visit_10km, d_p_nsdap, d_p_kpd, d_p_hitl, d_p_turnout)
# create lead visit variable; important to identify relevant exposure cases
elections_df_long <-
elections_df_long %>%
group_by(lfnr) %>%
mutate(l1.visit_10km = lead(visit_10km, 1), l2.visit_10km = lead(visit_10km, 2))
# select only matched data; compute summary statistics
match.data.long.list <- list()
match.data.group.list <- list()
match.data.sum.list <- list()
for (i in 1:4) {
match.data.long.list[[i]] <- elections_df_long[elections_df_long$lfnr %in% match.data.list[[i]]$lfnr,]
match.data.group.list[[i]] <-  group_by(match.data.long.list[[i]], election)
match.data.sum.list[[i]] <- summarize(match.data.group.list[[i]],
p_nsdap_untreated_avg = mean(p_nsdap[visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg = mean(p_nsdap[visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_1 = mean(p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_1 = mean(p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_2 = mean(p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_2 = mean(p_nsdap[l2.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg = mean(d_p_nsdap[visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg = mean(d_p_nsdap[visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_1 = mean(d_p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_1 = mean(d_p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_2 = mean(d_p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_2 = mean(d_p_nsdap[l2.visit_10km == 1], na.rm = TRUE))
}
pdf(file="../figures/pretreatment_trends.pdf", height=10, width=7, family="URWTimes")
par(oma=c(0,0,0,0))
par(mar=c(3,4,5,3))
par(mfrow=c(3,1))
par(xaxs = "i", yaxs = "i")
election_names <-  c("May 1928", "Sep 1930", "Jul 1932", "Nov 1932", "Mar 1933")
for (i in 2:4) {
# select relevant elections
dat <- match.data.long.list[[i]]
dat <- filter(dat, election <= i+1, election >= i-1)
election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched cases for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines, exposed units
dat <- arrange(dat, lfnr, election)
lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2))
# county lines, control units
lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1))
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
## plot: pre-treatment trends -----------
# import prepared data
load("elections_all_df_pointdata_long.RData")
elections_df_long <- filter(elections_df_long, election >= 1 &  election <= 5)
# select variables
elections_df_long <- dplyr::select(elections_df_long, election, lfnr, agglvl, name,  pop, wb, gs, p_nsdap, p_kpd, p_hitl, p_turnout, visit_10km, d_p_nsdap, d_p_kpd, d_p_hitl, d_p_turnout)
# create lead visit variable; important to identify relevant exposure cases
elections_df_long <-
elections_df_long %>%
group_by(lfnr) %>%
mutate(l1.visit_10km = lead(visit_10km, 1), l2.visit_10km = lead(visit_10km, 2))
# select only matched data; compute summary statistics
match.data.long.list <- list()
match.data.group.list <- list()
match.data.sum.list <- list()
for (i in 1:4) {
match.data.long.list[[i]] <- elections_df_long[elections_df_long$lfnr %in% match.data.list[[i]]$lfnr,]
match.data.group.list[[i]] <-  group_by(match.data.long.list[[i]], election)
match.data.sum.list[[i]] <- summarize(match.data.group.list[[i]],
p_nsdap_untreated_avg = mean(p_nsdap[visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg = mean(p_nsdap[visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_1 = mean(p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_1 = mean(p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_2 = mean(p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_2 = mean(p_nsdap[l2.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg = mean(d_p_nsdap[visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg = mean(d_p_nsdap[visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_1 = mean(d_p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_1 = mean(d_p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_2 = mean(d_p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_2 = mean(d_p_nsdap[l2.visit_10km == 1], na.rm = TRUE))
}
pdf(file="../figures/pretreatment_trends.pdf", height=10, width=7, family="URWTimes")
par(oma=c(0,0,0,0))
par(mar=c(3,4,5,3))
par(mfrow=c(3,1))
par(xaxs = "i", yaxs = "i")
election_names <-  c("May 1928", "Sep 1930", "Jul 1932", "Nov 1932", "Mar 1933")
for (i in 2:4) {
# select relevant elections
dat <- match.data.long.list[[i]]
dat <- filter(dat, election <= i+1, election >= i-1)
election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched cases for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines, exposed units
dat <- arrange(dat, lfnr, election)
lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2))
# county lines, control units
# lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
#      dat$p_nsdap[((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
#      type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1))
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
## plot: pre-treatment trends -----------
# import prepared data
load("elections_all_df_pointdata_long.RData")
elections_df_long <- filter(elections_df_long, election >= 1 &  election <= 5)
# select variables
elections_df_long <- dplyr::select(elections_df_long, election, lfnr, agglvl, name,  pop, wb, gs, p_nsdap, p_kpd, p_hitl, p_turnout, visit_10km, d_p_nsdap, d_p_kpd, d_p_hitl, d_p_turnout)
# create lead visit variable; important to identify relevant exposure cases
elections_df_long <-
elections_df_long %>%
group_by(lfnr) %>%
mutate(l1.visit_10km = lead(visit_10km, 1), l2.visit_10km = lead(visit_10km, 2))
# select only matched data; compute summary statistics
match.data.long.list <- list()
match.data.group.list <- list()
match.data.sum.list <- list()
for (i in 1:4) {
match.data.long.list[[i]] <- elections_df_long[elections_df_long$lfnr %in% match.data.list[[i]]$lfnr,]
match.data.group.list[[i]] <-  group_by(match.data.long.list[[i]], election)
match.data.sum.list[[i]] <- summarize(match.data.group.list[[i]],
p_nsdap_untreated_avg = mean(p_nsdap[visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg = mean(p_nsdap[visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_1 = mean(p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_1 = mean(p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_2 = mean(p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_2 = mean(p_nsdap[l2.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg = mean(d_p_nsdap[visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg = mean(d_p_nsdap[visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_1 = mean(d_p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_1 = mean(d_p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_2 = mean(d_p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_2 = mean(d_p_nsdap[l2.visit_10km == 1], na.rm = TRUE))
}
pdf(file="../figures/pretreatment_trends.pdf", height=10, width=7, family="URWTimes")
par(oma=c(0,0,0,0))
par(mar=c(3,4,5,3))
par(mfrow=c(3,1))
par(xaxs = "i", yaxs = "i")
election_names <-  c("May 1928", "Sep 1930", "Jul 1932", "Nov 1932", "Mar 1933")
for (i in 2:4) {
# select relevant elections
dat <- match.data.long.list[[i]]
dat <- filter(dat, election <= i+1, election >= i-1)
election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched cases for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines, exposed units
dat <- arrange(dat, lfnr, election)
# lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
#       dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
#       type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2))
# county lines, control units
lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1))
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
# import prepared data
load("elections_all_df_pointdata_long.RData")
elections_df_long <- filter(elections_df_long, election >= 1 &  election <= 5)
# select variables
elections_df_long <- dplyr::select(elections_df_long, election, lfnr, agglvl, name,  pop, wb, gs, p_nsdap, p_kpd, p_hitl, p_turnout, visit_10km, d_p_nsdap, d_p_kpd, d_p_hitl, d_p_turnout)
# create lead visit variable; important to identify relevant exposure cases
elections_df_long <-
elections_df_long %>%
group_by(lfnr) %>%
mutate(l1.visit_10km = lead(visit_10km, 1), l2.visit_10km = lead(visit_10km, 2))
# select only matched data; compute summary statistics
match.data.long.list <- list()
match.data.group.list <- list()
match.data.sum.list <- list()
for (i in 1:4) {
match.data.long.list[[i]] <- elections_df_long[elections_df_long$lfnr %in% match.data.list[[i]]$lfnr,]
match.data.group.list[[i]] <-  group_by(match.data.long.list[[i]], election)
match.data.sum.list[[i]] <- summarize(match.data.group.list[[i]],
p_nsdap_untreated_avg = mean(p_nsdap[visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg = mean(p_nsdap[visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_1 = mean(p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_1 = mean(p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
p_nsdap_untreated_avg_2 = mean(p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
p_nsdap_treated_avg_2 = mean(p_nsdap[l2.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg = mean(d_p_nsdap[visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg = mean(d_p_nsdap[visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_1 = mean(d_p_nsdap[l1.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_1 = mean(d_p_nsdap[l1.visit_10km == 1], na.rm = TRUE),
d_p_nsdap_untreated_avg_2 = mean(d_p_nsdap[l2.visit_10km != 1], na.rm = TRUE),
d_p_nsdap_treated_avg_2 = mean(d_p_nsdap[l2.visit_10km == 1], na.rm = TRUE))
}
pdf(file="../figures/pretreatment_trends.pdf", height=10, width=7, family="URWTimes")
par(oma=c(0,0,0,0))
par(mar=c(3,4,5,3))
par(mfrow=c(3,1))
par(xaxs = "i", yaxs = "i")
election_names <-  c("May 1928", "Sep 1930", "Jul 1932", "Nov 1932", "Mar 1933")
for (i in 2:4) {
# select relevant elections
dat <- match.data.long.list[[i]]
dat <- filter(dat, election <= i+1, election >= i-1)
election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched cases for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines, exposed units
dat <- arrange(dat, lfnr, election)
lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2))
# county lines, control units
lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[!((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1))
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
# model NSDAP vote share
model_voteshare_formula_simple <- paste("p_nsdap ~ time + exposure + timeXexposure",sep = "") %>% as.formula
model_voteshare_fullsample_simple <- list()
model_voteshare_matched_simple <- list()
for (i in 1:4) {
# full sample, lm simple model with voting population weights (i.e., only number of voters is considered)
dat_full <- getDatFull("county_df_long", election = i+1, treatment = "visit_10km")
model_voteshare_fullsample_simple[[i]] <- lm(model_voteshare_formula_simple, data =  dat_full, weights = dat_full$gs)
model_voteshare_fullsample_simple[[i]]$clusterse <- runClusterRobustOLS(model_voteshare_fullsample_simple[[i]], dat_full$lfnr)
# 1:1 matching, lm simple model with voting population weights * matching weights
dat_match <- match.data.list[[i]]
dat_match <- getDatMatch(dat.match = "dat_match", dat.orig = "county_df_long", election = i+1, treatment = "visit_10km")
dat_match$combweights <- dat_match$gs  * dat_match$weights
model_voteshare_matched_simple[[i]] <- lm(model_voteshare_formula_simple, data =  dat_match, weights = dat_match$combweights)
model_voteshare_matched_simple[[i]]$clusterse <- runClusterRobustOLS(model_voteshare_matched_simple[[i]], dat_match$lfnr)
}
model_voteshare_matched_simple[[2]] %>% summary
dat_match
dim(dat_match)
nrow(dat_match)
View(dat_match)
dat_match %>% arrange(lfnr, election) %>% View()
getDatFull
summary(model_voteshare_matched_simple[[1]])
summary(model_voteshare_matched_simple[[2]])
summary(model_voteshare_matched_simple[[3]])
summary(model_voteshare_matched_simple[[4]])
i=2
voters is considered)
dat_full <- getDatFull("county_df_long", election = i+1, treatment = "visit_10km")
model_voteshare_fullsample_simple[[i]] <- lm(model_voteshare_formula_simple, data =  dat_full, weights = dat_full$gs)
model_voteshare_fullsample_simple[[i]]$clusterse <- runClusterRobustOLS(model_voteshare_fullsample_simple[[i]], dat_full$lfnr)
# 1:1 matching, lm simple model with voting population weights * matching weights
dat_match <- match.data.list[[i]]
dat_match <- getDatMatch(dat.match = "dat_match", dat.orig = "county_df_long", election = i+1, treatment = "visit_10km")
dat_match$combweights <- dat_match$gs  * dat_match$weights
lm(model_voteshare_formula_simple, data =  dat_match) %>% summary
pdf(file="../figures/pretreatment_trends.pdf", height=10, width=7, family="URWTimes")
par(oma=c(0,0,0,0))
par(mar=c(3,4,5,3))
par(mfrow=c(3,1))
par(xaxs = "i", yaxs = "i")
election_names <-  c("May 1928", "Sep 1930", "Jul 1932", "Nov 1932", "Mar 1933")
for (i in 2:4) {
# select relevant elections
dat <- match.data.long.list[[i]]
dat <- filter(dat, election <= i+1, election >= i-1)
election_names_filtered <- election_names[(i-1):(i+1)]
# empty plot, axes
plot(dat$election-(i-2), dat$p_nsdap, cex=0, axes=F, ann = F, ylim=c(0,.8), xlim = c(.95, 3.05))
axis(1, las=0, at = seq(1,3,1), election_names_filtered, cex=.8)
axis(1, las=0, at = c(1.5,2.5), c("[pre-treatment period]", "[treatment period]"), cex=.8, tick = F)
axis(2, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
axis(4, las=1, at=seq(0,.8,.2), label=seq(0,.8,.2), cex=.8)
title(main = paste("Matched units for", election_names_filtered[3], "election"), ylab="NSDAP vote share", xlab="Election")
# write average trends
text(1.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_treated_avg_2[i-1]) %>% round(2)), col = "red")
text(1.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[i-1]) %>% round(2)), col = "black")
text(2.5, .72, labels = paste("Average trend, treatment group:", (match.data.sum.list[[i]]$p_nsdap_treated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_treated_avg_1[i]) %>% round(2)), col = "red")
text(2.5, .67, labels = paste("Average trend, control group:", (match.data.sum.list[[i]]$p_nsdap_untreated_avg[i+1] - match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[i]) %>% round(2)), col = "black")
abline(h=seq(0, 1, .2), lty = 2, col = "darkgrey")
# county lines, exposed units
dat <- arrange(dat, lfnr, election)
lines(dat$election[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)],
type = "b", lwd=1, col=rgb(.9,0,0, alpha=0.2))
# county lines, control units
lines(dat$election[-(dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1)]-(i-2),
dat$p_nsdap[!((dat$election == i+1 & dat$visit_10km == 1) | (dat$election == i &dat$l1.visit_10km == 1) | (dat$election == i-1 & dat$l2.visit_10km == 1))],
type = "b", lwd=1, col=rgb(0,0,0, alpha=0.1))
# average lines
match.data.sum.list[[i]] <- filter(match.data.sum.list[[i]], election <= i+1, election >= i-1)
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_untreated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_untreated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_untreated_avg[3]), type = "b", lwd = 3, lty = 1, col="black")
lines(match.data.sum.list[[i]]$election-(i-2),
c(match.data.sum.list[[i]]$p_nsdap_treated_avg_2[1],
match.data.sum.list[[i]]$p_nsdap_treated_avg_1[2],
match.data.sum.list[[i]]$p_nsdap_treated_avg[3]), type = "b", lwd = 3, lty = 1, col="red")
}
dev.off()
